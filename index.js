!function r(e,t,n){function o(a,c){if(!t[a]){if(!e[a]){var l="function"==typeof require&&require;if(!c&&l)return l(a,!0);if(i)return i(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var u=t[a]={exports:{}};e[a][0].call(u.exports,function(r){var t=e[a][1][r];return o(t||r)},u,u.exports,r,e,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(r,e,t){function n({recentClickX:r,recentClickY:e,commands:t}){u.allowAdvance&&(i({gameState:u,recentClickX:r,recentClickY:e,commands:t,probable:s}),f({gameState:u}))}function o(r,e,t,n,o){console.log(o)}var i=r("./flows/update"),a=r("./renderers/render"),c=r("./findwhere"),l=r("./generators/generate-grids"),d=r("./generators/generate-souls"),u={allowAdvance:!0,animations:[],ephemerals:{blasts:[]}},s={roll:r=>~~(Math.random()*r),rollDie:r=>~~(Math.random()*(r+1)),pickFromArray:r=>r[~~(Math.random()*r.length)]},f=a({onAdvance:n});window.onerror=o,u.grids=l({probable:s}),u.souls=d({probable:s,grids:u.grids}),u.player=c(u.souls,{id:"player"}),n({})},{"./findwhere":5,"./flows/update":8,"./generators/generate-grids":9,"./generators/generate-souls":10,"./renderers/render":19}],5:[function(r,e,t){e.exports=function(r,e){var t=Object.keys(e)[0];return r.find(function(r){return r[t]===e[t]})}},{}],19:[function(r,e,t){function n({onAdvance:r,uiOn:e}){function t({gameState:t}){!function(r){p.clearRect(0,0,h,g),r.grids.forEach(e=>o({imageContext:p,playerGridId:r.player.grid.id},e)),r.souls.forEach(r=>i({imageContext:p},r)),r.ephemerals.blasts.forEach(r=>a({imageContext:p},r))}(t),c({gameState:t,onAdvance:r,uiOn:e})}return f.addEventListener("click",function(e){r({recentClickX:e.offsetX,recentClickY:e.offsetY})}),t}var o=r("./render-grid"),i=r("./render-soul"),a=r("./render-blast"),c=r("./render-ui");const l=800;var d=document.querySelector("#canvases-container"),u=document.querySelector("#image-board"),s=document.querySelector("#ui-board"),f=document.querySelector("#input-board"),p=u.getContext("2d",{alpha:!1}),{boardWidth:h,boardHeight:g}=function(){var r=document.body.getBoundingClientRect().width;r>l&&(r=l);var e=document.body.getBoundingClientRect().height;return e<400&&(e=r),d.style.width=r,d.style.height=e,u.width=r,u.height=e,s.style.width=r,s.style.height=e,f.width=r,f.height=e,{boardWidth:r,boardHeight:e}}();e.exports=n},{"./render-blast":15,"./render-grid":16,"./render-soul":17,"./render-ui":18}],9:[function(r,e,t){var n=r("idmaker").randomId;e.exports=function({probable:r}){for(var e=[],t=1+r.rollDie(2),o=0;o<t;++o){let t={id:"grid-"+n(4),xSpace:40,ySpace:40,xOffset:0,yOffset:0,numberOfCols:20,numberOfRows:20,width:800,height:800,color:`hsl(${r.roll(360)}, 50%, 50%)`};t.rows=function(r){for(var e=[],t=0;t<r.numberOfRows;++t){let o=[];for(var n=0;n<r.numberOfCols;++n)o.push({x:r.xOffset+n*r.xSpace,y:r.yOffset+t*r.ySpace,col:n,row:t,gridId:r.id});e.push(o)}return e}(t),e.push(t)}return e}},{idmaker:13}],10:[function(r,e,t){var n=r("../defs/soul-defs"),o=r("idmaker").randomId;e.exports=function({probable:r,grids:e}){var t=JSON.parse(JSON.stringify(n.player));t.id="player";for(var i=[],a=r.rollDie(16)+r.roll(16),c=0;c<a;++c){let e=JSON.parse(JSON.stringify(n[0===r.roll(4)?"octo":"doof"]));e.id=e.type+"-"+o(4),i.push(e)}return i.push(t),i.forEach(function(t){let n=r.pickFromArray(e);t.grid={id:n.id,colOnGrid:r.roll(n.rows[0].length),rowOnGrid:r.roll(n.rows.length)}}),i}},{"../defs/soul-defs":3,idmaker:13}],8:[function(r,e,t){function n({gameState:r,recentClickX:e,recentClickY:t,commands:n,probable:l}){if(n)n.forEach(e=>(function(r,e){function t(e){!function(r,e){var t=function(r,e){return r.map(function(r){return r[e]})}(e,"id");e.forEach(i);for(var n=r.souls.length-1;n>=0;--n)-1!==t.indexOf(r.souls[n].id)&&r.souls.splice(n,1)}(r,n),s(e)}var n;"blast"===e.cmdType&&(n=p.search({minX:r.player.x-3*r.player.sprite.width,maxX:r.player.x+3*r.player.sprite.width,minY:r.player.y-3*r.player.sprite.height,maxY:r.player.y+3*r.player.sprite.height}),n=n.filter(o),console.log("blasting:",n),t(()=>console.log("souls removed.")))})(r,e));else{if(r.allowAdvance&&!isNaN(e)&&!isNaN(t)){var g=p.search({minX:e-f,maxX:e+f,minY:t-f,maxY:t+f}),m=d(g,{gridId:r.player.grid.id});m&&(m.col===r.player.grid.colOnGrid&&m.row===r.player.grid.rowOnGrid?r.uiOn=!0:function(r,e){return 1===u.getVectorMagnitude(u.subtractPairs(r,e))}([m.col,m.row],[r.player.grid.colOnGrid,r.player.grid.rowOnGrid])&&function(r,e,t,n){(function(r,e){r.player.grid.colOnGrid=e.col,r.player.grid.rowOnGrid=e.row})(r,t),r.souls.forEach(e=>(function(r,e,t){if("player"===t.id)return;var n=function(r,e){return[[r.grid.colOnGrid+1,r.grid.rowOnGrid],[r.grid.colOnGrid,r.grid.rowOnGrid+1],[r.grid.colOnGrid-1,r.grid.rowOnGrid],[r.grid.colOnGrid,r.grid.rowOnGrid-1]].filter(function(r){return r[0]>=0&&r[0]<e.rows[0].length&&r[1]>=0&&r[1]<e.rows.length})}(t,d(r.grids,{id:t.grid.id}));console.log("neighbors",n);var o=e.pickFromArray(n);t.grid.colOnGrid=o[0],t.grid.rowOnGrid=o[1]})(r,n,e))}(r,0,m,l))}0===h&&r.grids.forEach(r=>a(p,r)),r.souls.forEach(e=>c(r.grids,p,e)),h+=1}}function o(r){return r.type&&"player"!==r.type}function i(r){p.remove(r)}var a=r("./update-grid"),c=r("./update-soul"),l=r("../dumb-rbush"),d=r("../findwhere"),u=r("basic-2d-math"),s=r("call-next-tick");const f=20;var p=l(9),h=0;e.exports=n},{"../dumb-rbush":4,"../findwhere":5,"./update-grid":6,"./update-soul":7,"basic-2d-math":11,"call-next-tick":12}],2:[function(r,e,t){e.exports=function(r,e){for(var t=0;t<r.length;++t){let o=r[t];for(var n=0;n<o.length;++n)e(o[n])}}},{}],3:[function(r,e,t){e.exports={player:{type:"player",sprite:{col:2,row:0,width:32,height:32,hitRadius:48}},doof:{type:"doof",sprite:{col:1,row:0,width:32,height:32,hitRadius:100}},octo:{type:"octo",sprite:{col:0,row:0,width:32,height:32,hitRadius:32}}}},{}],4:[function(r,e,t){e.exports=function(){var r=[];return{search:function({minX:e,maxX:t,minY:n,maxY:o}){return r.filter(function(r){return r.x>=e&&r.x<=t&&r.y>=n&&r.y<=o})},remove:function(e){for(var t=-1,n=0;n<r.length;++n)if(r[n].id===e.id){t=n;break}t>-1&&r.splice(t,1)},insert:function(e){r.push(e)}}}},{}],6:[function(r,e,t){function n(r,e){!function(r){return void 0!==r.rows[0][0].minX}(e)&&(i(e.rows,o),i(e.rows,r.insert.bind(r)))}function o(r){r.minX=r.x-a,r.maxX=r.x+a,r.minY=r.y-a,r.maxY=r.y+a}var i=r("../apply-to-points-in-rows");const a=10;e.exports=n},{"../apply-to-points-in-rows":2}],7:[function(r,e,t){var n=r("../findwhere");e.exports=function(r,e,t){var o=n(r,{id:t.grid.id});if(o){var i=o.rows[t.grid.rowOnGrid][t.grid.colOnGrid];t.x=i.x,t.y=i.y,t.minX=t.x-t.sprite.width/2,t.maxX=t.x+t.sprite.width/2,t.minY=t.y-t.sprite.height/2,t.maxY=t.y+t.sprite.height/2,e.remove(t),e.insert(t)}else console.log("Could not find grid",t.grid.id,"for",t.id,"!")}},{"../findwhere":5}],11:[function(r,e,t){function n(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}e.exports={getVectorMagnitude:n,subtractPairs:function(r,e){return[r[0]-e[0],r[1]-e[1]]}}},{}],12:[function(r,e,t){(function(r){e.exports=function(){var e,t,n,o=arguments.length;if(!(o>0))throw new Error("No callback provided to callNextTick.");e=arguments[0],t=new Array(o-1);for(var i=1;i<o;++i)t[i-1]=arguments[i];n=function(r,e){return function(){r.apply(r,e)}}(e,t),r.nextTick(n)}}).call(this,r("_process"))},{_process:14}],13:[function(r,e,t){"object"==typeof e&&"object"==typeof e.exports&&(e.exports=function(){function r(r){return r[~~(Math.random()*r.length)]}var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return{randomId:function(t){for(var n="",o=0;o<t;++o)n+=r(e);return n}}}())},{}],14:[function(r,e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(r){if(u===setTimeout)return setTimeout(r,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(r,0);try{return u(r,0)}catch(e){try{return u.call(null,r,0)}catch(e){return u.call(this,r,0)}}}function a(){g&&p&&(g=!1,p.length?h=p.concat(h):m=-1,h.length&&c())}function c(){if(!g){var r=i(a);g=!0;for(var e=h.length;e;){for(p=h,h=[];++m<e;)p&&p[m].run();m=-1,e=h.length}p=null,g=!1,function(r){if(s===clearTimeout)return clearTimeout(r);if((s===o||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(r);try{s(r)}catch(e){try{return s.call(null,r)}catch(e){return s.call(this,r)}}}(r)}}function l(r,e){this.fun=r,this.array=e}function d(){}var u,s,f=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(r){u=n}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(r){s=o}}();var p,h=[],g=!1,m=-1;f.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];h.push(new l(r,e)),1!==h.length||g||i(c)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=d,f.addListener=d,f.once=d,f.off=d,f.removeListener=d,f.removeAllListeners=d,f.emit=d,f.prependListener=d,f.prependOnceListener=d,f.listeners=function(r){return[]},f.binding=function(r){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(r){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],15:[function(r,e,t){e.exports=function({imageContext:r,transform:e},t){r.strokeStyle=t.color,r.lineWidth=4,r.moveTo(e.applyX(t.cx),e.applyY(t.cy)),r.beginPath(),r.arc(e.applyX(t.cx),e.applyY(t.cy),e.k*t.r,0,2*Math.PI),r.stroke()}},{}],16:[function(r,e,t){function n({imageContext:r,playerGridId:e},t){!function({grid:r,imageContext:e,playerGridId:t}){var n=function(r){for(var e=[],t=0;t<r[0].length;++t){let n=[];for(let e=0;e<r.length;++e)n.push(r[e][t]);e.push(n)}return e}(r.rows);e.strokeStyle=r.color,e.lineWidth=t===r.id?2:1,n.forEach(function(r){e.moveTo(r[0].x,r[0].y),e.lineTo(r[0].x,r[r.length-1].y)}),r.rows.forEach(function(r){e.moveTo(r[0].x,r[0].y),e.lineTo(r[r.length-1].x,r[0].y),console.log("row",r)}),e.stroke()}({grid:t,imageContext:r,playerGridId:e}),function({grid:r,imageContext:e,playerGridId:t}){var n=t===r.id?8:4;e.fillStyle=r.color,e.beginPath(),o(r.rows,r=>(function(r,e,t){var n=t.x,o=t.y;r.moveTo(n,o),r.arc(n,o,e,0,2*Math.PI)})(e,n,r)),e.fill()}({grid:t,imageContext:r,playerGridId:e})}var o=r("../apply-to-points-in-rows");e.exports=n},{"../apply-to-points-in-rows":2}],17:[function(r,e,t){e.exports=function({imageContext:r},e){r.fillStyle="player"===e.id?"blue":"green",r.fillRect(e.x-e.sprite.width/2,e.y-e.sprite.height/2,e.sprite.width,e.sprite.height)}},{}],18:[function(r,e,t){var n,o=document.querySelector("#controls-layer"),i=document.querySelector("#blast-button"),a=document.querySelector("#help-layer"),c=document.querySelector("#close-help-button"),l=[];i.addEventListener("click",function(){l.push({cmdType:"blast"}),n()}),c.addEventListener("click",function(){a.classList.add("hidden"),n()}),e.exports=function({gameState:r,onAdvance:e}){l.length=0,r.uiOn?o.classList.remove("hidden"):o.classList.add("hidden"),o.classed("hidden",!r.uiOn),n=function(){r.uiOn=!1,e({gameState:r,commands:l})}}},{}]},{},[1]);